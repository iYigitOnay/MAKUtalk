generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  username  String   @unique
  password  String
  fullName  String?
  bio       String?  @db.Text
  avatarUrl String?
  coverUrl  String?  
  department String? // Bölüm bilgisi
  class      String? // Sınıf bilgisi (Hazırlık, 1, 2, 3, 4, Mezun vb.)
  isVerified Boolean  @default(false) // E-posta doğrulandı mı?
  isPrivate  Boolean  @default(false) // Hesap gizli mi?
  isBanned   Boolean  @default(false) // Banlı mı?
  role       UserRole @default(USER)
  verificationCode String? // 6 haneli doğrulama kodu
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Relations
  posts                Post[]
  likes                Like[]
  comments             Comment[]
  following            Follow[]       @relation("UserFollowing")
  followers            Follow[]       @relation("UserFollowers")
  notifications        Notification[] @relation("NotificationRecipient")
  triggeredNotifications Notification[] @relation("NotificationSender")
  blockedUsers         Block[]        @relation("Blocker")
  blockedBy            Block[]        @relation("Blocked")
  badges               UserBadge[]
  sentRequests         FollowRequest[] @relation("SentRequests")
  receivedRequests     FollowRequest[] @relation("ReceivedRequests")
}

model Badge {
  id          Int         @id @default(autoincrement())
  name        String      @unique
  icon        String?     // Emoji veya SVG adı
  color       String      @default("#1E3A8A") // Varsayılan Navy Blue
  description String?
  createdAt   DateTime    @default(now())

  users       UserBadge[]
}

model UserBadge {
  id        Int      @id @default(autoincrement())
  userId    Int
  badgeId   Int
  assignedAt DateTime @default(now())

  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  badge     Badge    @relation(fields: [badgeId], references: [id], onDelete: Cascade)

  @@unique([userId, badgeId])
}

model FollowRequest {
  id          Int      @id @default(autoincrement())
  senderId    Int
  receiverId  Int
  status      RequestStatus @default(PENDING)
  createdAt   DateTime @default(now())

  sender      User @relation("SentRequests", fields: [senderId], references: [id], onDelete: Cascade)
  receiver    User @relation("ReceivedRequests", fields: [receiverId], references: [id], onDelete: Cascade)

  @@unique([senderId, receiverId])
  @@index([receiverId])
}

enum RequestStatus {
  PENDING
  ACCEPTED
  REJECTED
}

enum UserRole {
  USER
  ADMIN
}

model Category {
  id          Int      @id @default(autoincrement())
  name        String   @unique
  slug        String   @unique
  description String?
  color       String   @default("#6B7280")
  icon        String?
  createdAt   DateTime @default(now())

  posts Post[]
}

model Post {
  id         Int      @id @default(autoincrement())
  content    String?  @db.Text
  published  Boolean  @default(true)
  authorId   Int
  categoryId Int?
  repostId   Int?     // Eğer bu bir repost ise orijinal postun ID'si
  sentiment      String?  // positive, negative, neutral
  sentimentScore Float?
  createdAt  DateTime @default(now())
  updatedAt  DateTime @default(now()) @updatedAt

  author        User           @relation(fields: [authorId], references: [id], onDelete: Cascade)
  category      Category?      @relation(fields: [categoryId], references: [id], onDelete: SetNull)
  repostOf      Post?          @relation("Reposts", fields: [repostId], references: [id], onDelete: Cascade)
  reposts       Post[]         @relation("Reposts")
  likes         Like[]
  comments      Comment[]
  notifications Notification[]

  @@index([authorId])
  @@index([categoryId])
  @@index([createdAt])
  @@index([repostId])
}

model Like {
  id        Int      @id @default(autoincrement())
  userId    Int
  postId    Int
  createdAt DateTime @default(now())

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@unique([userId, postId])
  @@index([postId])
  @@index([userId])
}

model Comment {
  id        Int      @id @default(autoincrement())
  content   String   @db.Text
  userId    Int
  postId    Int
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user User @relation(fields: [userId], references: [id], onDelete: Cascade)
  post Post @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([postId])
  @@index([userId])
}

model Follow {
  id          Int      @id @default(autoincrement())
  followerId  Int
  followingId Int
  createdAt   DateTime @default(now())

  follower  User @relation("UserFollowing", fields: [followerId], references: [id], onDelete: Cascade)
  following User @relation("UserFollowers", fields: [followingId], references: [id], onDelete: Cascade)

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

model Notification {
  id         Int              @id @default(autoincrement())
  type       NotificationType
  recipientId Int
  senderId   Int?
  postId     Int?
  read       Boolean          @default(false)
  createdAt  DateTime         @default(now())

  recipient User  @relation("NotificationRecipient", fields: [recipientId], references: [id], onDelete: Cascade)
  sender    User? @relation("NotificationSender", fields: [senderId], references: [id], onDelete: Cascade)
  post      Post? @relation(fields: [postId], references: [id], onDelete: Cascade)

  @@index([recipientId])
  @@index([read])
  @@index([createdAt])
}

model Block {
  id          Int      @id @default(autoincrement())
  blockerId   Int      // Engelleyen kullanıcı
  blockedId   Int      // Engellenen kullanıcı
  createdAt   DateTime @default(now())

  blocker     User     @relation("Blocker", fields: [blockerId], references: [id], onDelete: Cascade)
  blocked     User     @relation("Blocked", fields: [blockedId], references: [id], onDelete: Cascade)

  @@unique([blockerId, blockedId])
  @@index([blockerId])
  @@index([blockedId])
}

enum NotificationType {
  LIKE    // Biri postunu beğendi
  COMMENT // Biri postuna yorum yaptı
  FOLLOW  // Biri seni takip etti
}
